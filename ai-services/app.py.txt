from flask import Flask, request, jsonify
from flask_cors import CORS
import random

app = Flask(__name__)
CORS(app)

print("ðŸš€ MedMate Pro AI Services Started!")
print("ðŸ“¡ Server running on http://localhost:5000")

# Feature 1: Epidemic Predictor
@app.route('/api/epidemic-predictor', methods=['POST'])
def epidemic_predictor():
    data = request.json
    city = data.get('city', 'Mumbai')
    
    diseases = ['Dengue', 'Flu', 'Malaria', 'Typhoid']
    predicted_disease = random.choice(diseases)
    
    response = {
        'city': city,
        'predicted_disease': predicted_disease,
        'risk_level': 'HIGH',
        'message': f'ðŸš¨ {predicted_disease} cases expected to rise in {city} next month!',
        'recommended_medicines': get_medicines_for_disease(predicted_disease)
    }
    
    return jsonify(response)

# Feature 2: Demand Predictor
@app.route('/api/predict-demand', methods=['POST'])
def predict_demand():
    data = request.json
    medicine_name = data.get('medicine', 'Paracetamol')
    
    response = {
        'medicine': medicine_name,
        'predicted_demand': random.randint(50, 200),
        'confidence': f"{random.randint(75, 92)}%",
        'trend': random.choice(['INCREASING', 'DECREASING', 'STABLE']),
        'recommendation': 'Stock more' if random.random() > 0.5 else 'Maintain current stock'
    }
    
    return jsonify(response)

# Feature 3: Prescription OCR
@app.route('/api/ocr-prescription', methods=['POST'])
def ocr_prescription():
    sample_prescriptions = [
        "Dr. Sharma - Paracetamol 500mg - 1-0-1 - 5 days",
        "Dr. Verma - Amoxicillin 250mg - 0-1-0 - 7 days", 
        "Dr. Gupta - Vitamin C - 0-0-1 - 30 days"
    ]
    
    response = {
        'digital_text': random.choice(sample_prescriptions),
        'confidence': f"{random.randint(80, 95)}%",
        'medicines_detected': ['Paracetamol', 'Amoxicillin', 'Vitamin C'][:random.randint(1,3)],
        'message': 'âœ… Prescription successfully digitized!'
    }
    
    return jsonify(response)

def get_medicines_for_disease(disease):
    medicine_map = {
        'Dengue': ['Paracetamol', 'ORS', 'Platelet boosters'],
        'Flu': ['Vitamin C', 'Azithromycin', 'Cough Syrup'],
        'Malaria': ['Chloroquine', 'Primaquine'],
        'Typhoid': ['Ciprofloxacin', 'Ofloxacin']
    }
    return medicine_map.get(disease, ['General medicines'])

if __name__ == '__main__':
    app.run(debug=True, port=5000, host='0.0.0.0')